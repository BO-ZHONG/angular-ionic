var app=angular.module("myApp",["ionic","ngCordova"]);app.directive("cartnum",function(){return{restrict:"E",scope:!1,template:'<div class="cartStyle"><input type="button" value="-" ng-click="add_minus.jian()"/><input type="text"  value="{{values}}" name="values" disabled ><input type="button" value="+" ng-click="add_minus.jia()"/></div>',replace:!0,controller:function(e){e.add_minus={jian:function(){1!=e.values&&(e.values--,e.$emit("values",e.values))},jia:function(){e.values++,e.$emit("values",e.values)}}}}}),app.config(function(e,t,a){a.platform.ios.tabs.style("standard"),a.platform.ios.tabs.position("bottom"),a.platform.android.tabs.style("standard"),a.platform.android.tabs.position("standard"),a.platform.ios.navBar.alignTitle("center"),a.platform.android.navBar.alignTitle("left"),a.platform.ios.backButton.previousTitleText("").icon("ion-ios-arrow-thin-left"),a.platform.android.backButton.previousTitleText("").icon("ion-android-arrow-back"),a.platform.ios.views.transition("ios"),a.platform.android.views.transition("android"),a.backButton.text(""),a.backButton.previousTitleText(!1),t.otherwise("/home"),e.state("home",{url:"/home",templateUrl:"template/home.html",controller:"homeCtrl"}).state("home.slide",{url:"/slide",views:{"home-page":{templateUrl:"template/slide-box.html",controller:"homeCtrl"}}}).state("home.cart",{url:"/cart",views:{"home-cart":{templateUrl:"template/shopping_cart.html",controller:"shoppingCartCtrl"}}}).state("home.myMember",{url:"/myMember",views:{"home-myMember":{templateUrl:"template/myMember.html",controller:"homeCtrl"}}}).state("list",{cache:!1,url:"/list",templateUrl:"template/List.html",controller:"listCtrl"}).state("list.index",{url:"/index",views:{"list-goods":{templateUrl:"template/goods_index.html",controller:"listCtrl"}}}).state("list.arameter",{url:"/arameter",views:{"list-goods":{templateUrl:"template/goods_arameter.html"}}}).state("list.details",{url:"/details",views:{"list-goods":{templateUrl:"template/goods_details.html"}}}).state("list.assess",{url:"/assess",views:{"list-goods":{templateUrl:"template/goods_assess.html",controller:"listCtrl"}}}).state("list.assess.all",{url:"/all",views:{"evaluate-page":{templateUrl:"template/evaluate.html",controller:"listCtrl"}}}).state("list.assess.A",{url:"/A",views:{"evaluate-pageA":{templateUrl:"template/evaluate.html",controller:"listCtrl"}}}).state("list.assess.B",{url:"/B",views:{"evaluate-pageB":{templateUrl:"template/evaluate.html",controller:"listCtrl"}}}).state("list.assess.C",{url:"/C",views:{"evaluate-pageC":{templateUrl:"template/evaluate.html",controller:"listCtrl"}}}).state("Order",{cache:!1,url:"/Order?allPrice",templateUrl:"template/Order.html",controller:"orderCtrl"}).state("siteAll",{url:"/siteAll",templateUrl:"template/siteAll.html",controller:"orderCtrl"}).state("site",{url:"/site",templateUrl:"template/site.html",controller:"orderCtrl"})}),app.run(function(e,t,a){e.go("home")}),function(e){e.module("myApp").controller("homeCtrl",["$rootScope","$scope","myfactory","$state","$ionicHistory","$ionicSlideBoxDelegate","$cordovaVibration",function(t,a,l,i,s,n,o){a.views={listPic:[],listDatas:[],getPic:function(){l.getPic().then(function(e){200==e.status&&e.data&&(a.views.listPic=e.data.src,n.update())},function(e){})},getData:function(){l.getData().then(function(e){200==e.status&&e.data&&(a.views.listDatas=e.data.data)})},change:function(t){i.go("list.index"),l.storage.setVal("datas",t);var a=e.toJson(t);localStorage.setItem("a",a)},back:function(){s.goBack()}},a.views.getPic(),a.views.getData()}])}(angular),app.factory("myfactory",["$http",function(e){var t={},a={};return t.num=1,t.allPrice=0,t.offon=!0,t.index=0,t.sites="",t.keeps=[],t.cartData=[],t.cartDatass=[],t.getPic=function(){return e.get("src.json")},t.getData=function(){return e.get("details.json")},t.storage={setVal:function(e,t){e&&t&&(a[e]=t)},getVal:function(e){if(a[e]&&e)return a[e]}},t}]),app.factory("picResize",function(){function e(e,t,a){var l=new Image;l.src=e.src,l.onload=function(){l.width>30&&l.height>30&&(l.width/l.height>=t/a?l.width>t?(e.width=t,e.height=l.height*t/l.width):(e.width=l.width,e.height=l.height):l.height>a?(e.height=a,e.width=l.width*a/l.height):(e.width=l.width,e.height=l.height))}}var t=document.getElementsByClassName("pics"),a=window.screen.width,l=window.screen.height-20,a=document.documentElement.clientWidth,l=document.documentElement.clientHeight-20;return function(){a=window.innerWidth,l=window.innerHeight-20;for(var i=0,s=t.length;i<s;i++)e(t[i],a,l)}})(function(e){e.module("myApp").controller("shoppingCartCtrl",["$scope","myfactory","$cordovaVibration","$state","$ionicHistory",function(t,a,l,i,s){function n(a,l){t.indexs=t.cartData.indexOf(a);var i,s=e.element(document.getElementsByClassName("values")),n=e.element(document.getElementsByClassName("i")),o=s[t.indexs].value;2!=l&&1==s[t.indexs].value||(2==l?(s[t.indexs].value++,i=s[t.indexs].value,t.allPrice+=(i-o)*t.price):(s[t.indexs].value--,i=s[t.indexs].value,t.allPrice+=(i-o)*t.price),n[t.indexs].innerHTML="x"+s[t.indexs].value,t.nums=s[t.indexs].value)}function o(a,l,i){var s=t.cartData.indexOf(l),n=e.element(document.getElementsByClassName("i"));t.price=parseFloat(a.target.dataset.price.substring(1)),1==i?t.allPrice+=t.price*parseFloat(n[s].innerHTML.substring(1)):t.allPrice=t.allPrice-t.price*parseFloat(n[s].innerHTML.substring(1))}function r(a,l,i){var s=e.element(document.getElementsByClassName(i));t.allPrice=0,e.forEach(e.element(document.getElementsByClassName(a)),function(e,a){e.checked=l,1==l?t.allPrice+=parseFloat(e.dataset.price.substring(1))*parseFloat(s[a].innerHTML.substring(1)):t.allPrice=0}),t.isDisabled=!l}t.cartData=a.cartData,t.showDelete=!1,t.isDisabled=!0,t.isSelect=!1,t.allPrice=0,t.price=0,t.num=0,t.add_minus={jian:function(e){n(e,1)},jia:function(e){n(e,2)}},t.onItemDelete=function(e){t.cartData.splice(t.cartData.indexOf(e),1),t.showDelete=!1},t.isSelect=function(a,l){var i=!0;a.target.checked?(t.isDisabled=!1,o(a,l,1)):(o(a,l,2),e.forEach(e.element(document.getElementsByClassName("checks")),function(e,a,l){i&&(e.checked?(t.isDisabled=!1,i=!1):t.isDisabled=!0)}))},t.allSelect=function(e){1==e.target.checked?r("checks",!0,"i"):r("checks",!1)},t.order=function(){a.cartDatass.splice(0,a.cartDatass.length),e.forEach(e.element(document.getElementsByClassName("checks")),function(e,t,l){e.checked&&a.cartDatass.push(e.dataset.mydata.replace(/"([^"]*)"/g,"$1").split(","))}),i.go("Order",{allPrice:t.allPrice})}}])})(angular)(function(e){e.module("myApp").controller("orderCtrl",["$scope","$state","$ionicHistory","myfactory","$stateParams",function(t,a,l,i,s){t.allPrices=s.allPrice,t.cartDatass=i.cartDatass,t.site=function(){a.go("siteAll")},t.sitehtml=function(){a.go("site")},t.onItemDelete=function(e){t.list1.splice(t.list1.indexOf(e),1)},t.revise=function(e){i.index=e,i.offon=!1,a.go("site")},t.sites=i.sites,t.hui=function(){l.goBack()};var n="";t.offon=i.offon,t.keep=function(){0==t.offon?(e.forEach(e.element(document.getElementsByClassName("inputContent")),function(e){n+=e.value,i.keeps.splice(i.index,1,n)}),i.offon=!0):(e.forEach(e.element(document.getElementsByClassName("inputContent")),function(e){n+=e.value}),i.keeps.push(n))},t.list1=i.keeps,t.hui=function(){l.goBack(),e.forEach(e.element(document.getElementsByClassName("radios")),function(e,t,a){e.checked&&(i.sites=e.dataset.site)})}}])})(angular)(function(e){e.module("myApp").controller("listCtrl",["$rootScope","$scope","myfactory","$state","$ionicTabsDelegate","$ionicPopover","$ionicListDelegate","$timeout","picResize",function(t,a,l,i,s,n,o,r,c){a.$on("$ionicView.loaded",function(e,t){c()}),window.onresize=function(){c()},a.values=1,a.$on("values",function(e,t){a.values=t,l.num=a.values}),a.$broadcast("values",a.values),n.fromTemplateUrl("template/model.html",{scope:a,animation:"slide-in-up"}).then(function(e){a.popover=e});var u=0;a.openPopover=function(e,t){u=t,a.popover.show(e)},a.closePopover=function(){a.popover.hide()};var m,d=l.storage.getVal("datas");Array.prototype.max=function(){var e,t=this[0],a=this.length;for(e=0;e<a;e++)this[e]>t&&(t=this[e]);return t},a.views={all:function(){a.view=[],a.all=d.details_assess.all;var e=[a.all.A.length,a.all.B.length,a.all.C.length].max();for(m=0;m<e;m++)a.all.A.length>m&&a.view.push(a.all.A[m]),a.all.B.length>m&&a.view.push(a.all.B[m]),a.all.C.length>m&&a.view.push(a.all.C[m])},A:function(){a.view=d.details_assess.all.A},B:function(){a.view=d.details_assess.all.B},C:function(){a.view=d.details_assess.all.C},cart_data:function(e,t,s){void 0!=a.spec&&(1==u?l.cartData.push([a.spec,e,t,s,a.values]):(a.allPrice=0,l.cartDatass.splice(0,l.cartDatass.length),l.cartDatass.push([a.spec,e,t,s,a.values]),a.allPrice+=s.substring(1)*a.values,i.go("Order",{allPrice:a.allPrice})),a.closePopover())},selects:function(e){a.spec=e.target.value}},a.goCart=function(){i.go("home.cart")};var p=localStorage.getItem("a"),h=e.fromJson(p);a.views.datas=h}])})(angular);